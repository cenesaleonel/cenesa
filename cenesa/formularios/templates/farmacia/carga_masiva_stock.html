{% extends 'base.html' %}

{% block content %}
<div class="container mt-5">
    <h1 class="mb-4">Carga Masiva de Stock</h1>

    <form id="uploadForm" method="post" enctype="multipart/form-data" onsubmit="return validateFile()">
        {% csrf_token %}
        
        <!-- Mensajes de error -->
        <div id="errorMessages" class="alert alert-danger d-none" role="alert"></div>

        <div class="mb-3">
            {{ form.as_p }}
        </div>
        <div class="mt-3">
            <button type="submit" class="btn btn-primary">Cargar</button>
            <a href="{% url 'listar_stock' %}" class="btn btn-secondary">Cancelar</a>
        </div>
    </form>
</div>

<script>
// Función para validar que se suba un archivo Excel
function validateFile() {
    const input = document.querySelector('input[type="file"]');
    const file = input.files[0];
    const errorMessagesDiv = document.getElementById('errorMessages');
    let errorMessages = [];

    // Si no hay archivo seleccionado
    if (!file) {
        errorMessages.push("Por favor, selecciona un archivo.");
    } else {
        // Obtener la extensión del archivo
        const fileName = file.name;
        const fileExtension = fileName.split('.').pop().toLowerCase();

        // Validar que la extensión sea .xlsx o .xls
        if (fileExtension !== 'xlsx' && fileExtension !== 'xls') {
            errorMessages.push("Por favor, selecciona un archivo Excel válido (.xlsx o .xls).");
        }

        const maxSizeInBytes = 100 * 1024 * 1024; // 
        if (file.size > maxSizeInBytes) {
            errorMessages.push("El archivo es demasiado grande. El tamaño máximo permitido es 100 MB.");
        }
    }

    // Si hay errores, mostrar los mensajes y detener el envío del formulario
    if (errorMessages.length > 0) {
        errorMessagesDiv.innerHTML = errorMessages.join("<br>");
        errorMessagesDiv.classList.remove("d-none");
        return false;
    }

    // No hay errores, ocultar el mensaje de error y permitir el envío del formulario
    errorMessagesDiv.classList.add("d-none");
    return true;
}
</script>
{% endblock %}
